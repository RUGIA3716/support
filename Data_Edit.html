<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="./crypt_api.js"></script>
  <script src="./encryption.js"></script>
  <title>Document</title>
  <script>
    crypt_flag = true;
    function change(){
      console.log(document.getElementById("before").innerText);
      let before_string = document.getElementById("before").innerText.split("");
      let after_string = "";
      let crypt_string = "";
      console.log( before_string);
      let crypt_flag = false;
      let crypt_sting = document.getElementById("crypt_id").innerText;
      for(let i = 0; i < before_string.length; ++i){
        if(before_string[i] == "\""){
          if(crypt_flag == false){
            crypt_flag = true;
            after_string += before_string[i];
          }
          else{
            after_string += fencrypt_key(crypt_string, crypt_sting);
            crypt_string = "";
            after_string += before_string[i];
            crypt_flag = false;
          }
        }
        else{
          if(crypt_flag == false){          
            after_string += before_string[i];
          }
          else{
            crypt_string += before_string[i];
          }
        }
      }      
      console.log( after_string);
      document.getElementById("after").innerText = after_string;
    }

  </script>
</head>
<body>
  <div contenteditable="true" style = "width: 1000px; height: 50px;border: solid 1px black;outline: none;" id = "crypt_id"></div>
  <div contenteditable="true" style = "width: 1000px; height: 500px;border: solid 1px black;outline: none;" id = "before"></div>
  <button style = "margin-left: 100px;font-size: 30px;" onclick="change()">変換</button>
  <div contenteditable="true" style = "width: 1000px; height: 500px;border: solid 1px black;outline: : none;" id = "after"></div>
</body>
</html>